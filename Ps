param (
    [Parameter(Position=0, Mandatory=$true)]
    [string]$TargetHost,

    [Parameter(Position=1, Mandatory=$true)]
    [int]$TargetPort
)

function Trace-Port {
    param (
        [string]$Target,
        [int]$Port
    )

    $hops = tracert.exe $Target | Select-String -Pattern "^\s*\d+\s+\d+\.\d+\.\d+\.\d+" | ForEach-Object { $_.Line }

    foreach ($hop in $hops) {
        $columns = $hop -split "\s+"
        $hopIP = $columns[-1]

        Write-Host "Tracing hop: $hopIP"

        $tcpClient = New-Object System.Net.Sockets.TcpClient
        try {
            $tcpClient.Connect($hopIP, $Port)
            Write-Host ("Port $Port is open on $hopIP")
            $tcpClient.Close()
        } catch {
            Write-Host ("Port $Port is closed on $hopIP")
        }
    }
}

Trace-Port -Target $TargetHost -Port $TargetPort
